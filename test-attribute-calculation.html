<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±æ€§è®¡ç®—æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .character-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            background: #fafafa;
        }
        .character-name {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .attributes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .attr-section {
            background: white;
            padding: 10px;
            border-radius: 4px;
        }
        .attr-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        .attr-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 14px;
        }
        .attr-label {
            color: #666;
        }
        .attr-value {
            font-weight: bold;
            color: #333;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #5568d3;
        }
        .formula {
            background: #e8f4f8;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin: 20px 0;
            border-radius: 4px;
        }
        .formula-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .formula-item {
            margin: 5px 0;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® å±æ€§è®¡ç®—æµ‹è¯•</h1>
        
        <div class="formula">
            <div class="formula-title">ğŸ“ å±æ€§è®¡ç®—å…¬å¼</div>
            <div class="formula-item"><strong>ä¸»å±æ€§:</strong> æ¯ä¸ªè§’è‰²åˆå§‹1ç‚¹ï¼Œéšæœºåˆ†é…10ç‚¹</div>
            <div class="formula-item" style="margin-top: 10px; font-weight: bold; color: #667eea;">å‰¯å±æ€§ = åŸºç¡€å€¼ + ä¸»å±æ€§åŠ æˆ</div>
            <div class="formula-item"><strong>æ”»å‡»åŠ›:</strong> 10 + åŠ›é‡</div>
            <div class="formula-item"><strong>é˜²å¾¡åŠ›:</strong> 1 + åŠ›é‡ + æ•æ·</div>
            <div class="formula-item"><strong>ç§»åŠ¨é€Ÿåº¦:</strong> 50 + æ•æ·</div>
            <div class="formula-item"><strong>é—ªé¿ç‡:</strong> 0% + æ•æ· Ã— 0.5%</div>
            <div class="formula-item"><strong>æš´å‡»ç‡:</strong> 5% + æŠ€å·§ Ã— 0.5%</div>
            <div class="formula-item"><strong>æš´å‡»ä¼¤å®³:</strong> 150% + æŠ€å·§ Ã— 2%</div>
            <div class="formula-item"><strong>æŠ—æ€§:</strong> 0 + æ™ºæ…§ Ã— 0.5</div>
            <div class="formula-item"><strong>é­”æ³•å¼ºåº¦:</strong> 0 + æ™ºæ…§</div>
            <div class="formula-item"><strong>è´Ÿé‡:</strong> 10 + åŠ›é‡</div>
            <div class="formula-item"><strong>å‘½ä¸­ç‡:</strong> 100% + æŠ€å·§ Ã— 0.5%</div>
            <div class="formula-item"><strong>ç”Ÿå‘½å›å¤:</strong> 1 + åŠ›é‡ Ã— 0.2</div>
            <div class="formula-item"><strong>é­”æ³•å›å¤:</strong> 10 + æ™ºæ…§ Ã— 0.2</div>
            <div class="formula-item"><strong>ä½“é‡:</strong> 50 + åŠ›é‡</div>
            <div class="formula-item"><strong>æœ€å¤§HP:</strong> 100 + (æ‰€æœ‰ä¸»å±æ€§ä¹‹å’Œ) + (ç­‰çº§-1) Ã— 10</div>
            <div class="formula-item"><strong>æœ€å¤§MP:</strong> 100 (å›ºå®šå€¼)</div>
        </div>

        <button onclick="generateCharacter()">ç”Ÿæˆæ–°è§’è‰²</button>
        <button onclick="clearCharacters()">æ¸…ç©º</button>
        
        <div id="characters"></div>
    </div>

    <script type="module">
        // ç®€åŒ–çš„NPCç³»ç»Ÿæ¨¡æ‹Ÿ
        class NPCSystemTest {
            constructor() {
                this.counter = 0;
                this.namePool = ['æ', 'ç‹', 'æ—', 'åˆ˜', 'è‚¯å°¼', 'å¡æ‹‰', 'æœ¬ç”°', 'äº”è—', 'å¥¥æ‹‰', 'æ‹‰å°”'];
                this.titlePool = ['å‹‡æ•¢çš„', 'èƒ†å°çš„', 'å¥½è‰²çš„', 'å†·é…·çš„', 'ç›®å…‰å‘†æ»çš„', 'å£é½¿ä¸æ¸…çš„', 'è½æ’çš„', 'è°¨æ…çš„', 'ä¹è§‚çš„', 'ç»“å·´çš„'];
            }

            getRandomElement(array) {
                return array[Math.floor(Math.random() * array.length)];
            }

            calculateSecondaryAttributes(strength, agility, wisdom, skill) {
                return {
                    attack: 10 + strength,
                    defense: 1 + strength + agility,
                    moveSpeed: 50 + agility,
                    dodgeRate: 0 + agility * 0.5,
                    critRate: 5 + skill * 0.5,
                    critDamage: 150 + skill * 2,
                    resistance: 0 + wisdom * 0.5,
                    magicPower: 0 + wisdom,
                    carryWeight: 10 + strength,
                    accuracy: 100 + skill * 0.5,
                    expRate: 100,
                    hpRegen: 1 + strength * 0.2,
                    mpRegen: 10 + wisdom * 0.2,
                    weight: 50 + strength,
                    volume: 100
                };
            }

            calculateMaxHPMP(strength, agility, wisdom, skill, level) {
                const attributeHPBonus = strength + agility + wisdom + skill;
                const maxHP = 100 + attributeHPBonus + (level - 1) * 10;
                const maxMP = 100; // Fixed value
                return { maxHP, maxMP };
            }

            createAdventurer() {
                this.counter++;
                const randomName = this.getRandomElement(this.namePool);
                const randomTitle = this.getRandomElement(this.titlePool);
                
                // éšæœºåˆ†é…10ç‚¹å±æ€§
                const totalPoints = 10;
                const attributes = { strength: 1, agility: 1, wisdom: 1, skill: 1 };
                
                for (let i = 0; i < totalPoints; i++) {
                    const attributeKeys = Object.keys(attributes);
                    const randomAttribute = this.getRandomElement(attributeKeys);
                    attributes[randomAttribute]++;
                }
                
                // è®¡ç®—å‰¯å±æ€§
                const secondaryAttrs = this.calculateSecondaryAttributes(
                    attributes.strength,
                    attributes.agility,
                    attributes.wisdom,
                    attributes.skill
                );
                
                // è®¡ç®—æœ€å¤§HPå’ŒMP
                const { maxHP, maxMP } = this.calculateMaxHPMP(
                    attributes.strength,
                    attributes.agility,
                    attributes.wisdom,
                    attributes.skill,
                    1
                );
                
                return {
                    id: `adventurer_${this.counter}`,
                    name: randomName,
                    title: randomTitle,
                    level: 1,
                    ...attributes,
                    ...secondaryAttrs,
                    maxHP,
                    maxMP,
                    currentHP: maxHP,
                    currentMP: 0
                };
            }
        }

        const npcSystem = new NPCSystemTest();
        window.npcSystem = npcSystem;

        window.generateCharacter = function() {
            const character = npcSystem.createAdventurer();
            displayCharacter(character);
        };

        window.clearCharacters = function() {
            document.getElementById('characters').innerHTML = '';
        };

        function displayCharacter(char) {
            const container = document.getElementById('characters');
            const card = document.createElement('div');
            card.className = 'character-card';
            
            card.innerHTML = `
                <div class="character-name">${char.title}${char.name} (LV ${char.level})</div>
                <div class="attributes">
                    <div class="attr-section">
                        <div class="attr-title">ğŸ’ª ä¸»å±æ€§</div>
                        <div class="attr-item">
                            <span class="attr-label">åŠ›é‡ (STR)</span>
                            <span class="attr-value">${char.strength}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">æ•æ· (AGI)</span>
                            <span class="attr-value">${char.agility}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">æ™ºæ…§ (WIS)</span>
                            <span class="attr-value">${char.wisdom}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">æŠ€å·§ (SKL)</span>
                            <span class="attr-value">${char.skill}</span>
                        </div>
                        <div class="attr-item" style="border-top: 1px solid #eee; margin-top: 5px; padding-top: 5px;">
                            <span class="attr-label">æ€»å’Œ</span>
                            <span class="attr-value">${char.strength + char.agility + char.wisdom + char.skill}</span>
                        </div>
                    </div>
                    <div class="attr-section">
                        <div class="attr-title">âš”ï¸ å‰¯å±æ€§</div>
                        <div class="attr-item">
                            <span class="attr-label">æ”»å‡»åŠ›</span>
                            <span class="attr-value">${char.attack}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">é˜²å¾¡åŠ›</span>
                            <span class="attr-value">${char.defense}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">ç§»åŠ¨é€Ÿåº¦</span>
                            <span class="attr-value">${char.moveSpeed}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">é—ªé¿ç‡</span>
                            <span class="attr-value">${char.dodgeRate.toFixed(1)}%</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">æš´å‡»ç‡</span>
                            <span class="attr-value">${char.critRate.toFixed(1)}%</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">æš´å‡»ä¼¤å®³</span>
                            <span class="attr-value">${char.critDamage.toFixed(0)}%</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">æŠ—æ€§</span>
                            <span class="attr-value">${char.resistance.toFixed(1)}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">é­”æ³•å¼ºåº¦</span>
                            <span class="attr-value">${char.magicPower}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">è´Ÿé‡</span>
                            <span class="attr-value">${char.carryWeight}</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">å‘½ä¸­ç‡</span>
                            <span class="attr-value">${char.accuracy.toFixed(1)}%</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">ç”Ÿå‘½å›å¤</span>
                            <span class="attr-value">${char.hpRegen.toFixed(1)}/s</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">é­”æ³•å›å¤</span>
                            <span class="attr-value">${char.mpRegen.toFixed(1)}/s</span>
                        </div>
                        <div class="attr-item">
                            <span class="attr-label">ä½“é‡</span>
                            <span class="attr-value">${char.weight}</span>
                        </div>
                    </div>
                </div>
                <div class="attributes" style="margin-top: 10px;">
                    <div class="attr-section">
                        <div class="attr-title">â¤ï¸ ç”Ÿå‘½å€¼</div>
                        <div class="attr-item">
                            <span class="attr-label">å½“å‰/æœ€å¤§</span>
                            <span class="attr-value">${char.currentHP} / ${char.maxHP}</span>
                        </div>
                    </div>
                    <div class="attr-section">
                        <div class="attr-title">ğŸ’™ é­”æ³•å€¼</div>
                        <div class="attr-item">
                            <span class="attr-label">å½“å‰/æœ€å¤§</span>
                            <span class="attr-value">${char.currentMP} / ${char.maxMP}</span>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(card);
        }

        // è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè§’è‰²ä½œä¸ºç¤ºä¾‹
        window.generateCharacter();
    </script>
</body>
</html>
