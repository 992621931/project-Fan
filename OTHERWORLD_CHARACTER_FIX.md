# å¼‚ç•Œè§’è‰²ä»“åº“æ˜¾ç¤ºä¿®å¤

## é—®é¢˜æè¿°

ç”¨æˆ·ä½¿ç”¨å¼€å‘è€…åŠŸèƒ½è·å¾—å¼‚ç•Œè§’è‰²åï¼Œè§’è‰²æ²¡æœ‰åœ¨ä»“åº“çš„è§’è‰²åˆ†é¡µä¸­æ˜¾ç¤ºã€‚

## æ ¹æœ¬åŸå› 

å¼‚ç•Œè§’è‰²åˆ›å»ºæ—¶åªåˆ›å»ºäº† ECS ç»„ä»¶ï¼Œä½†æ²¡æœ‰æ³¨å†Œåˆ° `NPCSystem`ã€‚æ¸¸æˆçš„ä»“åº“ç³»ç»Ÿä¾èµ– `NPCSystem.getRecruitedCharacters()` æ¥è·å–å·²æ‹›å‹Ÿçš„è§’è‰²åˆ—è¡¨ã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®æ”¹ `createOtherworldCharacter` æ–¹æ³•

å°†å¼‚ç•Œè§’è‰²åˆ›å»ºé€»è¾‘ä»çº¯ ECS ç»„ä»¶æ–¹å¼æ”¹ä¸ºåˆ›å»º `NPCData` å¯¹è±¡å¹¶æ³¨å†Œåˆ° `NPCSystem`ã€‚

**å…³é”®æ”¹åŠ¨**ï¼š

1. **ç”Ÿæˆå”¯ä¸€ ID**ï¼š
   ```typescript
   const characterId = `otherworld_${charConfig.id}_${Date.now()}`;
   ```

2. **è®¡ç®—æ¬¡çº§å±æ€§**ï¼š
   ä»åŸºç¡€å±æ€§ï¼ˆåŠ›é‡ã€æ•æ·ã€æ™ºæ…§ã€æŠ€å·§ï¼‰è®¡ç®—æ¬¡çº§å±æ€§ï¼ˆæ”»å‡»ã€é˜²å¾¡ã€ç§»é€Ÿç­‰ï¼‰ï¼š
   ```typescript
   const baseAttack = Math.floor(charConfig.baseAttributes.strength * 2 + charConfig.baseAttributes.technique * 0.5);
   const baseDefense = Math.floor(charConfig.baseAttributes.strength * 0.5 + charConfig.baseAttributes.agility * 0.3);
   const baseMoveSpeed = Math.floor(100 + charConfig.baseAttributes.agility * 2);
   // ... å…¶ä»–å±æ€§è®¡ç®—
   ```

3. **åˆ›å»º NPCData å¯¹è±¡**ï¼š
   å°† `OtherworldCharacterConfig` è½¬æ¢ä¸º `NPCData` æ ¼å¼ï¼š
   ```typescript
   const npcData: NPCData = {
     id: characterId,
     name: charConfig.name,
     title: charConfig.title,
     emoji: 'ğŸŒŸ', // å¼‚ç•Œè§’è‰²ç‰¹æ®Šæ ‡è®°
     type: 'Adventurer',
     // ... æ‰€æœ‰å¿…éœ€å­—æ®µ
   };
   ```

4. **æ³¨å†Œåˆ° NPCSystem**ï¼š
   ```typescript
   this.npcSystem.recruitCharacter(npcData);
   ```

5. **åº”ç”¨é¥±è…¹åº¦ BUFF**ï¼š
   ```typescript
   this.checkHungerBuff(characterId, charConfig.initialState.maxHunger);
   ```

### 2. å±æ€§è®¡ç®—å…¬å¼

å¼‚ç•Œè§’è‰²çš„æ¬¡çº§å±æ€§æ ¹æ®åŸºç¡€å±æ€§è®¡ç®—ï¼š

| æ¬¡çº§å±æ€§ | è®¡ç®—å…¬å¼ |
|---------|---------|
| æ”»å‡»åŠ› | åŠ›é‡ Ã— 2 + æŠ€å·§ Ã— 0.5 |
| é˜²å¾¡åŠ› | åŠ›é‡ Ã— 0.5 + æ•æ· Ã— 0.3 |
| ç§»åŠ¨é€Ÿåº¦ | 100 + æ•æ· Ã— 2 |
| é—ªé¿ç‡ | æ•æ· Ã— 0.5 |
| æš´å‡»ç‡ | æŠ€å·§ Ã— 0.8 |
| æš´å‡»ä¼¤å®³ | 150 + æŠ€å·§ Ã— 2 |
| é­”æ³•æŠ—æ€§ | æ™ºæ…§ Ã— 0.5 |
| é­”æ³•å¼ºåº¦ | æ™ºæ…§ Ã— 2 |
| è´Ÿé‡ | 50 + åŠ›é‡ Ã— 5 |
| å‘½ä¸­ç‡ | 80 + æŠ€å·§ Ã— 0.5 |
| ç”Ÿå‘½å›å¤ | 1 + åŠ›é‡ Ã— 0.1 |
| é­”æ³•å›å¤ | 1 + æ™ºæ…§ Ã— 0.1 |

### 3. ä¸å†’é™©è€…è§’è‰²çš„å…¼å®¹æ€§

å¼‚ç•Œè§’è‰²ç°åœ¨ä¸å†’é™©è€…è§’è‰²ä½¿ç”¨ç›¸åŒçš„åŸºç±» `NPCData`ï¼Œç¡®ä¿ï¼š

- âœ… åœ¨ä»“åº“ä¸­æ­£ç¡®æ˜¾ç¤º
- âœ… å¯ä»¥åŠ å…¥ç¼–é˜Ÿ
- âœ… å¯ä»¥å‚ä¸æˆ˜æ–—
- âœ… å¯ä»¥è£…å¤‡ç‰©å“
- âœ… å¯ä»¥å­¦ä¹ æŠ€èƒ½
- âœ… å¯ä»¥å‡çº§å’Œè·å¾—ç»éªŒ
- âœ… å—é¥±è…¹åº¦ç³»ç»Ÿå½±å“

## æµ‹è¯•éªŒè¯

åˆ›å»ºäº† `test-otherworld-character-warehouse.html` æµ‹è¯•æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹æµ‹è¯•ï¼š

1. **ç³»ç»Ÿåˆå§‹åŒ–æµ‹è¯•** - éªŒè¯ DataLoaderã€ConfigManagerã€NPCSystem æ­£ç¡®åˆå§‹åŒ–
2. **è·å–å¼‚ç•Œè§’è‰²é…ç½®** - éªŒè¯å¯ä»¥ä» ConfigManager è·å–å¼‚ç•Œè§’è‰²æ•°æ®
3. **åˆ›å»ºå¼‚ç•Œè§’è‰²** - æ¨¡æ‹Ÿå¼€å‘è€…åŠŸèƒ½åˆ›å»ºè§’è‰²
4. **éªŒè¯è§’è‰²åœ¨ä»“åº“ä¸­** - ç¡®è®¤è§’è‰²å·²æ³¨å†Œåˆ° NPCSystem
5. **æ˜¾ç¤ºæ‰€æœ‰å·²æ‹›å‹Ÿè§’è‰²** - åˆ—å‡ºæ‰€æœ‰ä»“åº“ä¸­çš„è§’è‰²

## ä½¿ç”¨æ–¹æ³•

### åœ¨æ¸¸æˆä¸­ä½¿ç”¨

1. å¯åŠ¨æ¸¸æˆ
2. æ‰“å¼€å¼€å‘è€…é¢æ¿
3. ç‚¹å‡»"ğŸŒŸ è·å¾—å¼‚ç•Œè§’è‰²"æŒ‰é’®
4. é€‰æ‹©ä¸€ä¸ªå¼‚ç•Œè§’è‰²
5. è§’è‰²å°†è¢«æ·»åŠ åˆ°ä»“åº“ä¸­
6. åœ¨ä»“åº“çš„è§’è‰²åˆ†é¡µä¸­å¯ä»¥çœ‹åˆ°è¯¥è§’è‰²

### è¿è¡Œæµ‹è¯•

1. æ„å»ºé¡¹ç›®ï¼š`npm run build`
2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `test-otherworld-character-warehouse.html`
3. æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰æµ‹è¯•
4. éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡

## ç¤ºä¾‹ï¼šAllenes è§’è‰²

ä» `otherworld-characters.json` åŠ è½½çš„ Allenes è§’è‰²ï¼š

```json
{
  "id": "allenes",
  "name": "Allenes",
  "title": "å¼‚ç•Œæ—…è€…",
  "characterTypes": ["å¼‚ç•Œ", "å†’é™©è€…"],
  "portrait": "images/touxiang_yijie_Allenes",
  "rarity": 3,
  "isSpecial": true,
  "initialState": {
    "level": 1,
    "maxHealth": 100,
    "maxMana": 100,
    "maxHunger": 100
  },
  "baseAttributes": {
    "strength": 10,
    "agility": 5,
    "wisdom": 3,
    "technique": 2
  },
  "startingJob": "warrior",
  "availableJobs": ["warrior"],
  "initialSkills": {
    "passive": [],
    "active": ["fumo_zhan"]
  }
}
```

è½¬æ¢ä¸º NPCData åï¼š

```typescript
{
  id: "otherworld_allenes_1234567890",
  name: "Allenes",
  title: "å¼‚ç•Œæ—…è€…",
  emoji: "ğŸŒŸ",
  type: "Adventurer",
  level: 1,
  currentHP: 100,
  maxHP: 100,
  currentMP: 100,
  maxMP: 100,
  currentHunger: 100,
  maxHunger: 100,
  job: "æˆ˜å£«",
  strength: 10,
  agility: 5,
  wisdom: 3,
  skill: 2,
  attack: 21,      // 10*2 + 2*0.5 = 21
  defense: 6,      // 10*0.5 + 5*0.3 = 6.5 â†’ 6
  moveSpeed: 110,  // 100 + 5*2 = 110
  // ... å…¶ä»–å±æ€§
}
```

## æ–‡ä»¶ä¿®æ”¹

- âœ… `src/ui/GameUI.ts` - ä¿®æ”¹ `createOtherworldCharacter` æ–¹æ³•
- âœ… `test-otherworld-character-warehouse.html` - æ–°å¢æµ‹è¯•æ–‡ä»¶
- âœ… `OTHERWORLD_CHARACTER_FIX.md` - æœ¬æ–‡æ¡£

## æ³¨æ„äº‹é¡¹

1. **ID ç”Ÿæˆ**ï¼šå¼‚ç•Œè§’è‰²çš„ ID æ ¼å¼ä¸º `otherworld_{configId}_{timestamp}`ï¼Œç¡®ä¿å”¯ä¸€æ€§
2. **èŒä¸šæ˜¾ç¤º**ï¼šä½¿ç”¨ `getJobDisplayName()` æ–¹æ³•å°†è‹±æ–‡èŒä¸š ID è½¬æ¢ä¸ºä¸­æ–‡æ˜¾ç¤ºåç§°
3. **ç‰¹æ®Šæ ‡è®°**ï¼šå¼‚ç•Œè§’è‰²ä½¿ç”¨ ğŸŒŸ emoji ä½œä¸ºç‰¹æ®Šæ ‡è¯†
4. **å±æ€§è®¡ç®—**ï¼šç¡®ä¿æ¬¡çº§å±æ€§çš„è®¡ç®—ä¸æ¸¸æˆä¸­å…¶ä»–è§’è‰²ä¿æŒä¸€è‡´
5. **é¥±è…¹åº¦**ï¼šå¼‚ç•Œè§’è‰²åŒæ ·å—é¥±è…¹åº¦ç³»ç»Ÿå½±å“ï¼Œéœ€è¦è¿›é£Ÿ

## åç»­æ”¹è¿›å»ºè®®

1. **å¤´åƒæ”¯æŒ**ï¼šä¸ºå¼‚ç•Œè§’è‰²æ·»åŠ ä¸“ç”¨å¤´åƒæ˜¾ç¤º
2. **ç‰¹æ®ŠæŠ€èƒ½**ï¼šç¡®ä¿å¼‚ç•Œè§’è‰²çš„ä¸“å±æŠ€èƒ½ï¼ˆå¦‚"ä¼é­”æ–©"ï¼‰æ­£ç¡®åŠ è½½å’Œæ˜¾ç¤º
3. **ç¨€æœ‰åº¦æ˜¾ç¤º**ï¼šåœ¨ä»“åº“ä¸­çªå‡ºæ˜¾ç¤ºå¼‚ç•Œè§’è‰²çš„ç¨€æœ‰åº¦
4. **ç±»å‹æ ‡ç­¾**ï¼šåœ¨è§’è‰²å¡ç‰‡ä¸Šæ˜¾ç¤º"å¼‚ç•Œ"ç±»å‹æ ‡ç­¾
5. **åˆå§‹è£…å¤‡**ï¼šè€ƒè™‘ä¸ºå¼‚ç•Œè§’è‰²é…ç½®åˆå§‹è£…å¤‡

## æ€»ç»“

é€šè¿‡å°†å¼‚ç•Œè§’è‰²åˆ›å»ºé€»è¾‘æ”¹ä¸ºä½¿ç”¨ `NPCData` æ ¼å¼å¹¶æ³¨å†Œåˆ° `NPCSystem`ï¼Œå¼‚ç•Œè§’è‰²ç°åœ¨å¯ä»¥ï¼š

- âœ… æ­£ç¡®æ˜¾ç¤ºåœ¨ä»“åº“ä¸­
- âœ… ä¸å†’é™©è€…è§’è‰²ä½¿ç”¨ç›¸åŒçš„åŸºç±»
- âœ… äº«å—æ‰€æœ‰æ¸¸æˆç³»ç»Ÿçš„æ”¯æŒ
- âœ… ä¿æŒæ•°æ®ä¸€è‡´æ€§

ä¿®å¤å®Œæˆï¼
