<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•Œäººç³»ç»Ÿæµ‹è¯•</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 20px;
    }

    .test-area {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .battle-area {
      width: 100%;
      height: 500px;
      background: url('images/changjing_caoyuan.png') center/cover;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .enemy-list {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      max-height: 500px;
      overflow-y: auto;
    }

    .enemy-list h3 {
      margin: 0 0 15px 0;
      color: #333;
    }

    .enemy-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .enemy-card {
      background: #f8f9fa;
      border: 2px solid #dc3545;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .enemy-card:hover {
      background: #fff;
      border-color: #c82333;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .enemy-card-content {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .enemy-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
      position: relative;
    }

    .enemy-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .enemy-info {
      flex: 1;
      min-width: 0;
    }

    .enemy-name {
      font-size: 13px;
      font-weight: bold;
      color: #dc3545;
      margin-bottom: 4px;
    }

    .enemy-stats {
      font-size: 10px;
      color: #666;
      line-height: 1.4;
    }

    .controls {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    button.danger {
      background: #dc3545;
    }

    button.danger:hover {
      background: #c82333;
    }

    .info {
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.6;
    }

    .info h3 {
      margin: 0 0 10px 0;
      color: #333;
    }

    .info p {
      margin: 5px 0;
      color: #666;
    }

    .enemy-counter {
      display: inline-block;
      background: #dc3545;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 14px;
      margin-left: 10px;
    }

    .limit-controls {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .limit-controls input {
      width: 80px;
      padding: 8px;
      border: 2px solid #667eea;
      border-radius: 4px;
      font-size: 14px;
    }

    .limit-controls button {
      padding: 8px 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ‰ æ•Œäººç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="test-area">
      <div>
        <h3 style="color: white; margin-bottom: 10px;">æˆ˜æ–—åœºæ™¯</h3>
        <div class="battle-area" id="battle-area"></div>
      </div>
      
      <div>
        <h3 style="color: white; margin-bottom: 10px;">æ•Œäººæ¨¡æ¿åˆ—è¡¨</h3>
        <div class="enemy-list">
          <h3>å¯ç”Ÿæˆçš„æ•Œäºº</h3>
          <div class="enemy-grid" id="enemy-templates"></div>
        </div>
      </div>
    </div>
    
    <div class="controls">
      <h3>
        æ§åˆ¶é¢æ¿
        <span class="enemy-counter" id="enemy-counter">æ•Œäºº: 0/10</span>
      </h3>
      <div class="button-group">
        <button onclick="spawnRandomEnemy()">ğŸ² ç”Ÿæˆéšæœºæ•Œäºº</button>
        <button onclick="spawnAllEnemies()">ğŸ‘¹ ç”Ÿæˆæ‰€æœ‰æ•Œäºº</button>
        <button onclick="toggleAutoSpawn()" id="auto-spawn-btn">â–¶ï¸ å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆ</button>
        <button onclick="spawnAdventurer()">ğŸ‘¤ ç”Ÿæˆå†’é™©è€…</button>
        <button class="danger" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰</button>
      </div>
      
      <div class="limit-controls">
        <label>æ•Œäººæ•°é‡ä¸Šé™ï¼š</label>
        <input type="number" id="max-enemies-input" value="10" min="1" max="50" />
        <button onclick="updateMaxEnemies()">è®¾ç½®ä¸Šé™</button>
      </div>
      
      <div class="info">
        <h3>ğŸ“‹ è¯´æ˜</h3>
        <p>âœ… å·²åˆ›å»º8ç§æ•Œäººé¢„åˆ¶ä½“</p>
        <p>âœ… æ•Œäººæ‹¥æœ‰ç‹¬ç«‹çš„å±æ€§ï¼šç”Ÿå‘½å€¼ã€æ”»å‡»åŠ›ã€é˜²å¾¡åŠ›ã€ç§»åŠ¨é€Ÿåº¦ç­‰</p>
        <p>âœ… æ•Œäººåˆå§‹é­”æ³•å€¼ä¸º0ï¼Œä¸ä¼šè‡ªåŠ¨æ¢å¤HP/MP</p>
        <p>âœ… ç‚¹å‡»å³ä¾§æ•Œäººå¡ç‰‡å¯ä»¥ç”Ÿæˆå¯¹åº”çš„æ•Œäºº</p>
        <p>âœ… æ•Œäººä¼šåœ¨åœºæ™¯ä¸­éšæœºä½ç½®ç”Ÿæˆå¹¶ç§»åŠ¨</p>
        <p>âœ… <strong>è‰åŸåœºæ™¯ä¼šæ¯éš”3-8ç§’è‡ªåŠ¨ç”Ÿæˆæ•Œäºº</strong></p>
        <p>âœ… <strong>è‡ªåŠ¨ç”Ÿæˆçš„æ•Œäººä¼šè¿œç¦»å†’é™©è€…è§’è‰²ï¼ˆè‡³å°‘200åƒç´ ï¼‰</strong></p>
        <p>âœ… <strong>å†’é™©è€…è§’è‰²ä¼šä¼˜å…ˆé€‰æ‹©è¿œç¦»æ•Œäººçš„ä½ç½®ç”Ÿæˆ</strong></p>
        <p>âœ… <strong>åªä¼šç”Ÿæˆï¼šæ¹¿åœ°åŒå¤´è›‡ã€ç”œæµ†å²è±å§†ã€å·¨å‹è‰è‡è™«</strong></p>
        <p>âœ… <strong>æ•Œäººæ•°é‡ä¸Šé™é»˜è®¤ä¸º10ä¸ªï¼Œè¾¾åˆ°ä¸Šé™åä¸å†ç”Ÿæˆ</strong></p>
        <p>ğŸ’¡ æ•Œäººè¾¹æ¡†ä¸ºçº¢è‰²ï¼Œä¸å‹æ–¹è§’è‰²ï¼ˆç™½è‰²è¾¹æ¡†ï¼‰åŒºåˆ†</p>
        <p>ğŸ’¡ å¯ä»¥åœ¨ä¸Šæ–¹è®¾ç½®æ•Œäººæ•°é‡ä¸Šé™ï¼ˆ1-50ï¼‰</p>
        <p>ğŸ’¡ å…ˆç”Ÿæˆæ•Œäººï¼Œå†ç”Ÿæˆå†’é™©è€…ï¼Œå¯ä»¥çœ‹åˆ°å†’é™©è€…è¿œç¦»æ•Œäººçš„æ•ˆæœ</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { BattleSystem } from './dist/game/systems/BattleSystem.js';
    import { EnemySystem } from './dist/game/systems/EnemySystem.js';
    import { World } from './dist/ecs/World.js';
    
    const battleArea = document.getElementById('battle-area');
    const templatesContainer = document.getElementById('enemy-templates');
    
    const world = new World();
    const battleSystem = new BattleSystem();
    const enemySystem = new EnemySystem(world);
    
    battleSystem.initialize(battleArea);
    
    let autoSpawnEnabled = false;
    let adventurerCounter = 0;
    
    // Grassland enemy types
    const grasslandEnemies = [
      'enemy_wetland_two_headed_snake',
      'enemy_sweet_syrup_slime',
      'enemy_giant_grass_mushroom_worm'
    ];
    
    // Update enemy counter display
    function updateEnemyCounter() {
      const counter = document.getElementById('enemy-counter');
      const currentCount = battleSystem.getEnemyCount();
      const maxCount = battleSystem.getMaxEnemies();
      counter.textContent = `æ•Œäºº: ${currentCount}/${maxCount}`;
      
      // Change color based on limit
      if (currentCount >= maxCount) {
        counter.style.background = '#ffc107';
      } else {
        counter.style.background = '#dc3545';
      }
    }
    
    // Update counter every 500ms
    setInterval(updateEnemyCounter, 500);
    
    // Wait for enemy templates to load
    setTimeout(() => {
      loadEnemyTemplates();
    }, 500);
    
    function loadEnemyTemplates() {
      const templates = enemySystem.getAllEnemyTemplates();
      
      if (templates.length === 0) {
        templatesContainer.innerHTML = '<p style="text-align: center; color: #999;">åŠ è½½ä¸­...</p>';
        setTimeout(loadEnemyTemplates, 500);
        return;
      }
      
      templatesContainer.innerHTML = '';
      
      templates.forEach(template => {
        const card = document.createElement('div');
        card.className = 'enemy-card';
        
        // Highlight grassland enemies
        const isGrasslandEnemy = grasslandEnemies.includes(template.id);
        if (isGrasslandEnemy) {
          card.style.borderColor = '#28a745';
          card.style.borderWidth = '3px';
        }
        
        const content = document.createElement('div');
        content.className = 'enemy-card-content';
        
        const avatar = document.createElement('div');
        avatar.className = 'enemy-avatar';
        const img = document.createElement('img');
        img.src = template.emoji;
        avatar.appendChild(img);
        
        const info = document.createElement('div');
        info.className = 'enemy-info';
        
        const name = document.createElement('div');
        name.className = 'enemy-name';
        name.textContent = template.name;
        if (isGrasslandEnemy) {
          name.textContent += ' ğŸŒ¾';
        }
        
        const stats = document.createElement('div');
        stats.className = 'enemy-stats';
        stats.innerHTML = `
          HP: ${template.maxHP} | ATK: ${template.attack}<br>
          DEF: ${template.defense} | SPD: ${template.moveSpeed}
        `;
        
        info.appendChild(name);
        info.appendChild(stats);
        
        content.appendChild(avatar);
        content.appendChild(info);
        card.appendChild(content);
        
        card.addEventListener('click', () => {
          spawnEnemy(template.id);
        });
        
        templatesContainer.appendChild(card);
      });
      
      console.log(`Loaded ${templates.length} enemy templates`);
    }
    
    function spawnEnemy(templateId) {
      const enemy = enemySystem.createEnemy(templateId);
      if (!enemy) {
        console.error('Failed to create enemy');
        return;
      }
      
      battleSystem.spawnCharacterAwayFromAdventurers(enemy, 200);
      console.log(`Spawned: ${enemy.name} (HP: ${enemy.maxHP}, ATK: ${enemy.attack}, DEF: ${enemy.defense})`);
    }
    
    function spawnGrasslandEnemy() {
      const randomType = grasslandEnemies[Math.floor(Math.random() * grasslandEnemies.length)];
      spawnEnemy(randomType);
    }
    
    window.spawnRandomEnemy = function() {
      const enemy = enemySystem.createRandomEnemy();
      if (!enemy) {
        console.error('Failed to create random enemy');
        return;
      }
      
      battleSystem.spawnCharacter(enemy);
      console.log(`Spawned random enemy: ${enemy.name}`);
    };
    
    window.spawnAllEnemies = function() {
      const templates = enemySystem.getAllEnemyTemplates();
      templates.forEach(template => {
        spawnEnemy(template.id);
      });
      console.log(`Spawned all ${templates.length} enemy types`);
    };
    
    window.toggleAutoSpawn = function() {
      autoSpawnEnabled = !autoSpawnEnabled;
      const btn = document.getElementById('auto-spawn-btn');
      
      if (autoSpawnEnabled) {
        btn.textContent = 'â¸ï¸ åœæ­¢è‡ªåŠ¨ç”Ÿæˆ';
        btn.style.background = '#ffc107';
        battleSystem.startEnemySpawning(() => {
          spawnGrasslandEnemy();
        });
        console.log('Auto-spawn enabled (3-8 seconds interval)');
      } else {
        btn.textContent = 'â–¶ï¸ å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆ';
        btn.style.background = '#667eea';
        battleSystem.stopEnemySpawning();
        console.log('Auto-spawn disabled');
      }
    };
    
    window.spawnAdventurer = function() {
      adventurerCounter++;
      const names = ['æ', 'ç‹', 'æ—', 'åˆ˜', 'è‚¯å°¼', 'å¡æ‹‰'];
      const titles = ['å‹‡æ•¢çš„', 'èƒ†å°çš„', 'å†·é…·çš„', 'è°¨æ…çš„'];
      const randomName = names[Math.floor(Math.random() * names.length)];
      const randomTitle = titles[Math.floor(Math.random() * titles.length)];
      
      const adventurer = {
        id: `adventurer_${adventurerCounter}`,
        name: randomName,
        title: randomTitle,
        emoji: `images/touxiang_maoxianzhe_${String(Math.floor(Math.random() * 48) + 1).padStart(3, '0')}.png`,
        type: 'Adventurer',
        level: Math.floor(Math.random() * 5) + 1,
        currentHP: 100,
        maxHP: 100,
        currentMP: 0,
        maxMP: 100,
        moveSpeed: Math.floor(Math.random() * 50) + 20,
        hpRegen: Math.floor(Math.random() * 5) + 1,
        mpRegen: Math.floor(Math.random() * 15) + 5,
        job: 'Adventurer'
      };
      
      battleSystem.spawnCharacter(adventurer);
      console.log(`Spawned adventurer: ${adventurer.title}${adventurer.name}`);
      updateEnemyCounter();
    };
    
    window.updateMaxEnemies = function() {
      const input = document.getElementById('max-enemies-input');
      const newMax = parseInt(input.value);
      
      if (isNaN(newMax) || newMax < 1 || newMax > 50) {
        alert('è¯·è¾“å…¥1-50ä¹‹é—´çš„æ•°å­—');
        input.value = battleSystem.getMaxEnemies();
        return;
      }
      
      battleSystem.setMaxEnemies(newMax);
      updateEnemyCounter();
      console.log(`Max enemies set to ${newMax}`);
    };
    
    window.clearAll = function() {
      battleSystem.stopEnemySpawning();
      battleSystem.clearAll();
      enemySystem.clearAllEnemies();
      autoSpawnEnabled = false;
      const btn = document.getElementById('auto-spawn-btn');
      btn.textContent = 'â–¶ï¸ å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆ';
      btn.style.background = '#667eea';
      updateEnemyCounter();
      console.log('Cleared all characters');
    };
  </script>
</body>
</html>
