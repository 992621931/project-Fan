<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ¹é¥ªå›¾æ ‡æµ‹è¯• - ç®€åŒ–ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #2c3e50;
            color: white;
        }
        .info {
            background: #34495e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover {
            background: #2980b9;
        }
        #status {
            background: #1abc9c;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .error {
            background: #e74c3c !important;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>ğŸ³ çƒ¹é¥ªå›¾æ ‡æµ‹è¯• - ç®€åŒ–ç‰ˆ</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ–°çš„çƒ¹é¥ªé¢æ¿ä»£ç æ˜¯å¦å·²åŠ è½½</p>
        <p><strong>æ„å»ºæ—¶é—´æˆ³ï¼š</strong> <span id="buildTime"></span></p>
    </div>

    <button onclick="testCookingPanel()">æµ‹è¯•çƒ¹é¥ªé¢æ¿</button>
    <button onclick="checkVersion()">æ£€æŸ¥ä»£ç ç‰ˆæœ¬</button>

    <div id="status">ç­‰å¾…æµ‹è¯•...</div>

    <script type="module">
        import { World } from './dist/ecs/World.js';
        import { ItemSystem } from './dist/game/systems/ItemSystem.js';
        import { CookingSystem } from './dist/game/systems/CookingSystem.js';
        import { UIManager } from './dist/ui/UIManager.js';
        import { EventSystem } from './dist/ecs/EventSystem.js';
        import { CookingPanel } from './dist/ui/components/CookingPanel.js';

        // æ˜¾ç¤ºæ„å»ºæ—¶é—´
        document.getElementById('buildTime').textContent = new Date().toLocaleString();

        // åˆå§‹åŒ–ç³»ç»Ÿ
        const world = new World();
        const eventSystem = new EventSystem();
        const itemSystem = new ItemSystem(world);
        const cookingSystem = new CookingSystem();
        const uiManager = new UIManager(eventSystem);

        world.addSystem(itemSystem);
        world.addSystem(cookingSystem);
        world.initialize();

        cookingSystem.setItemSystem(itemSystem);

        // åˆ›å»ºçƒ¹é¥ªé¢æ¿
        const cookingPanel = new CookingPanel(uiManager, eventSystem, world, cookingSystem);
        cookingPanel.setPlayerId(1);

        // æ·»åŠ æµ‹è¯•ææ–™
        itemSystem.addItem('mystic_mushroom', 10);
        itemSystem.addItem('sweet_syrup_gland', 5);

        // åŠ è½½é…æ–¹
        fetch('src/game/data/cooking-recipes.json')
            .then(res => res.json())
            .then(data => {
                cookingSystem.loadRecipes(data);
                console.log('âœ… é…æ–¹åŠ è½½å®Œæˆ');
                updateStatus('âœ… é…æ–¹åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', false);
            })
            .catch(err => {
                console.error('âŒ é…æ–¹åŠ è½½å¤±è´¥:', err);
                updateStatus('âŒ é…æ–¹åŠ è½½å¤±è´¥: ' + err.message, true);
            });

        window.testCookingPanel = function() {
            console.log('=== å¼€å§‹æµ‹è¯•çƒ¹é¥ªé¢æ¿ ===');
            updateStatus('æ­£åœ¨æµ‹è¯•...', false);

            try {
                // æ˜¾ç¤ºé¢æ¿
                cookingPanel.show();
                cookingPanel.render();

                // æ£€æŸ¥ renderIngredients æ–¹æ³•
                const hasNewMethod = cookingPanel.toString().includes('ingredients-grid');
                console.log('æ–°ä»£ç æ£€æµ‹:', hasNewMethod ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');

                if (hasNewMethod) {
                    updateStatus('âœ… æ–°ä»£ç å·²åŠ è½½ï¼çƒ¹é¥ªé¢æ¿åº”è¯¥æ˜¾ç¤ºå›¾æ ‡ç½‘æ ¼ã€‚', false);
                } else {
                    updateStatus('âŒ æ—§ä»£ç ä»åœ¨è¿è¡Œã€‚è¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•ã€‚', true);
                }

                // ç­‰å¾…ä¸€ä¸‹è®©é¢æ¿æ¸²æŸ“
                setTimeout(() => {
                    const grid = document.querySelector('[class*="ingredients-grid"]');
                    if (grid) {
                        console.log('âœ… æ‰¾åˆ°ææ–™ç½‘æ ¼å®¹å™¨');
                        updateStatus('âœ… æ‰¾åˆ°ææ–™ç½‘æ ¼å®¹å™¨ï¼å›¾æ ‡åº”è¯¥æ­£åœ¨æ˜¾ç¤ºã€‚', false);
                    } else {
                        console.log('âŒ æœªæ‰¾åˆ°ææ–™ç½‘æ ¼å®¹å™¨');
                        updateStatus('âŒ æœªæ‰¾åˆ°ææ–™ç½‘æ ¼å®¹å™¨ã€‚å¯èƒ½éœ€è¦é€‰æ‹©ä¸€ä¸ªé…æ–¹ã€‚', true);
                    }
                }, 500);

            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                updateStatus('âŒ æµ‹è¯•å¤±è´¥: ' + error.message, true);
            }
        };

        window.checkVersion = function() {
            console.log('=== æ£€æŸ¥ä»£ç ç‰ˆæœ¬ ===');
            
            // æ£€æŸ¥ CookingPanel çš„æ–¹æ³•
            const panelMethods = Object.getOwnPropertyNames(Object.getPrototypeOf(cookingPanel));
            console.log('CookingPanel æ–¹æ³•:', panelMethods);

            // å°è¯•è¯»å– renderIngredients çš„æºç 
            const renderIngredientsStr = cookingPanel.constructor.prototype.renderIngredients?.toString() || '';
            const hasGridLayout = renderIngredientsStr.includes('ingredients-grid');
            const hasIconContainer = renderIngredientsStr.includes('ingredient-icon');
            const hasQuantityBadge = renderIngredientsStr.includes('quantity-badge');

            console.log('ä»£ç ç‰¹å¾æ£€æµ‹:');
            console.log('- ç½‘æ ¼å¸ƒå±€:', hasGridLayout ? 'âœ…' : 'âŒ');
            console.log('- å›¾æ ‡å®¹å™¨:', hasIconContainer ? 'âœ…' : 'âŒ');
            console.log('- æ•°é‡æ ‡ç­¾:', hasQuantityBadge ? 'âœ…' : 'âŒ');

            if (hasGridLayout && hasIconContainer && hasQuantityBadge) {
                updateStatus('âœ… æ–°ä»£ç å·²æ­£ç¡®åŠ è½½ï¼æ‰€æœ‰ç‰¹å¾éƒ½å­˜åœ¨ã€‚', false);
            } else {
                updateStatus('âŒ ä»£ç ç‰ˆæœ¬ä¸æ­£ç¡®ã€‚è¯·æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°æ„å»ºã€‚', true);
            }
        };

        function updateStatus(message, isError) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            if (isError) {
                statusDiv.classList.add('error');
            } else {
                statusDiv.classList.remove('error');
            }
        }

        // è‡ªåŠ¨æ£€æŸ¥ç‰ˆæœ¬
        setTimeout(() => {
            window.checkVersion();
        }, 1000);
    </script>
</body>
</html>
