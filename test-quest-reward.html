<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quest Reward System Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .currency-display {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(26, 26, 26, 0.8);
      color: white;
      padding: 16px;
      border-radius: 8px;
      display: flex;
      gap: 16px;
    }
    .currency-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .quest-panel {
      max-width: 800px;
      margin: 80px auto 20px;
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .quest-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 2px solid transparent;
      transition: all 0.3s;
    }
    .quest-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      border-color: #667eea;
    }
    .quest-name {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }
    .quest-progress {
      font-size: 14px;
      color: #667eea;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .quest-rewards {
      font-size: 14px;
      color: #28a745;
      margin-bottom: 12px;
    }
    .button-container {
      display: flex;
      gap: 8px;
    }
    button {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    .complete-btn {
      background: #ffc107;
      color: #333;
    }
    .complete-btn:hover {
      background: #e0a800;
    }
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 16px 24px;
      background: #28a745;
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 1000;
    }
    h2 {
      margin-top: 0;
      color: #333;
    }
    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: #667eea;
      margin: 24px 0 12px;
    }
  </style>
</head>
<body>
  <div class="currency-display">
    <div class="currency-item">
      <span style="font-size: 20px;">ğŸ’°</span>
      <span id="gold-amount" style="font-size: 16px; font-weight: bold;">100</span>
    </div>
    <div class="currency-item">
      <span style="font-size: 20px;">ğŸ’</span>
      <span id="crystal-amount" style="font-size: 16px; font-weight: bold;">0</span>
    </div>
    <div class="currency-item">
      <span style="font-size: 20px;">ğŸ†</span>
      <span id="reputation-amount" style="font-size: 16px; font-weight: bold;">0</span>
    </div>
  </div>

  <div class="quest-panel">
    <h2>ä»»åŠ¡å¥–åŠ±ç³»ç»Ÿæµ‹è¯•</h2>
    <p>è¿™ä¸ªæµ‹è¯•æ¼”ç¤ºäº†ä»»åŠ¡å®Œæˆåå¦‚ä½•å¢åŠ ç©å®¶çš„é‡‘å¸æ•°é‡ã€‚</p>
    
    <div class="section-title">è¿›è¡Œä¸­çš„ä»»åŠ¡</div>
    <div id="quest-container"></div>
    
    <div class="section-title" id="completed-section" style="display: none;">å·²å®Œæˆä»»åŠ¡</div>
    <div id="completed-container"></div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    // Simulate player currency
    let playerCurrency = {
      gold: 100,
      crystal: 0,
      reputation: 0
    };

    // Test quest data
    const quests = {
      inProgress: [
        {
          id: 'quest_main_1',
          name: 'åˆåˆ°æ‘åº„',
          progress: '1/1',
          rewards: 'ğŸ’° 500é‡‘å¸',
          status: 'inProgress'
        },
        {
          id: 'quest_test_2',
          name: 'æ”¶é›†ææ–™',
          progress: '5/10',
          rewards: 'ğŸ’° 200é‡‘å¸',
          status: 'inProgress'
        },
        {
          id: 'quest_test_3',
          name: 'å‡»è´¥æ€ªç‰©',
          progress: '3/3',
          rewards: 'ğŸ’° 300é‡‘å¸ + ğŸ’ 10æ°´æ™¶',
          status: 'inProgress'
        }
      ],
      completed: []
    };

    function updateCurrencyDisplay() {
      document.getElementById('gold-amount').textContent = playerCurrency.gold.toLocaleString();
      document.getElementById('crystal-amount').textContent = playerCurrency.crystal.toLocaleString();
      document.getElementById('reputation-amount').textContent = playerCurrency.reputation.toLocaleString();
    }

    function isQuestObjectiveCompleted(progress) {
      const match = progress.match(/(\d+)\/(\d+)/);
      if (!match) return false;
      
      const current = parseInt(match[1], 10);
      const total = parseInt(match[2], 10);
      
      return current >= total;
    }

    function completeQuest(quest) {
      const questIndex = quests.inProgress.findIndex(q => q.id === quest.id);
      if (questIndex === -1) return;
      
      const completedQuest = quests.inProgress.splice(questIndex, 1)[0];
      completedQuest.status = 'completed';
      quests.completed.push(completedQuest);
      
      // Parse and award rewards
      const goldMatch = quest.rewards.match(/(\d+)é‡‘å¸/);
      const crystalMatch = quest.rewards.match(/(\d+)æ°´æ™¶/);
      
      let rewardMessage = 'ä»»åŠ¡å®Œæˆï¼';
      
      if (goldMatch) {
        const goldAmount = parseInt(goldMatch[1], 10);
        playerCurrency.gold += goldAmount;
        rewardMessage += ` è·å¾— ${goldAmount} é‡‘å¸`;
      }
      
      if (crystalMatch) {
        const crystalAmount = parseInt(crystalMatch[1], 10);
        playerCurrency.crystal += crystalAmount;
        rewardMessage += ` + ${crystalAmount} æ°´æ™¶`;
      }
      
      showNotification(rewardMessage);
      updateCurrencyDisplay();
      renderQuests();
    }

    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    function renderQuests() {
      const container = document.getElementById('quest-container');
      const completedContainer = document.getElementById('completed-container');
      const completedSection = document.getElementById('completed-section');
      
      container.innerHTML = '';
      completedContainer.innerHTML = '';
      
      // Render in-progress quests
      if (quests.inProgress.length === 0) {
        container.innerHTML = '<p style="color: #999;">æš‚æ— è¿›è¡Œä¸­çš„ä»»åŠ¡</p>';
      } else {
        quests.inProgress.forEach(quest => {
          const card = document.createElement('div');
          card.className = 'quest-card';
          
          const isCompleted = isQuestObjectiveCompleted(quest.progress);
          
          card.innerHTML = `
            <div class="quest-name">${quest.name}</div>
            <div class="quest-progress">è¿›åº¦: ${quest.progress}</div>
            <div class="quest-rewards">å¥–åŠ±: ${quest.rewards}</div>
            ${isCompleted ? `
              <div class="button-container">
                <button class="complete-btn">å®Œæˆ</button>
              </div>
            ` : '<div style="color: #999; font-size: 12px;">ä»»åŠ¡è¿›è¡Œä¸­...</div>'}
          `;
          
          if (isCompleted) {
            const btn = card.querySelector('.complete-btn');
            btn.addEventListener('click', () => completeQuest(quest));
          }
          
          container.appendChild(card);
        });
      }
      
      // Render completed quests
      if (quests.completed.length > 0) {
        completedSection.style.display = 'block';
        quests.completed.forEach(quest => {
          const card = document.createElement('div');
          card.className = 'quest-card';
          card.style.opacity = '0.7';
          card.innerHTML = `
            <div class="quest-name">âœ“ ${quest.name}</div>
            <div class="quest-progress">è¿›åº¦: ${quest.progress}</div>
            <div class="quest-rewards">å¥–åŠ±: ${quest.rewards}</div>
            <div style="color: #28a745; font-size: 12px; margin-top: 8px;">å·²å®Œæˆ</div>
          `;
          completedContainer.appendChild(card);
        });
      } else {
        completedSection.style.display = 'none';
      }
    }

    // Initial render
    updateCurrencyDisplay();
    renderQuests();
  </script>
</body>
</html>
