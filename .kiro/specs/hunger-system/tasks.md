# 实现计划：饱腹度系统

## 概述

本实现计划将饱腹度系统分为三个主要阶段：数据层实现（组件定义）、业务逻辑层实现（角色创建集成）、表现层实现（UI 显示）。每个阶段都包含相应的测试任务，确保功能的正确性和可靠性。

## 任务

- [x] 1. 定义 HungerComponent 组件
  - 在 `src/game/components/CharacterComponents.ts` 中添加 HungerComponent 接口定义
  - 定义 current 和 maximum 字段
  - 使用 createComponentType 创建 HungerComponentType
  - 导出组件类型供其他模块使用
  - _需求：1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 1.1 编写 HungerComponent 的属性测试
  - **属性 1：饱腹度值范围不变性**
  - **验证：需求 7.1, 7.2, 7.3**
  - 使用 fast-check 生成随机饱腹度值
  - 验证 current 始终在 [0, maximum] 范围内
  - 验证 maximum 始终大于 0

- [x] 2. 在角色创建系统中集成 HungerComponent
  - [x] 2.1 修改 CharacterRecruitmentSystem 添加饱腹度初始化
    - 在角色创建流程中添加 HungerComponent
    - 设置 maximum 为 100
    - 设置 current 等于 maximum（满饱腹度状态）
    - _需求：2.1, 2.2, 2.3, 2.4_

  - [x] 2.2 编写角色初始化的属性测试
    - **属性 2：组件初始化完整性**
    - **验证：需求 2.1, 2.2, 2.3**
    - 生成随机角色创建参数
    - 验证新角色具有 HungerComponent
    - 验证 current = maximum = 100

- [x] 3. 检查点 - 确保数据层测试通过
  - 运行所有测试确保组件定义和初始化正确
  - 如有问题请询问用户

- [x] 4. 在 CharacterPanel 中添加饱腹度进度条显示
  - [x] 4.1 在 renderCharacterDetails 方法中添加饱腹度进度条
    - 在经验值进度条之后添加饱腹度进度条 HTML
    - 使用与生命值、魔法值相同的进度条结构
    - 设置标签文本为"饱腹度"
    - 显示 current / maximum 格式的数值
    - 计算并设置进度条宽度百分比
    - _需求：3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

  - [x] 4.2 添加饱腹度进度条的 CSS 样式
    - 在 addDetailStyles 方法中添加 .hunger-bar 样式
    - 使用橙色系颜色（如 #f39c12）
    - 确保与其他进度条样式一致
    - _需求：4.1, 4.2, 4.3, 4.4, 4.5_

  - [x] 4.3 编写 UI 显示的单元测试
    - 测试饱腹度进度条的渲染
    - 测试进度条位置在经验值之后、好感度之前
    - 测试进度条数值显示正确
    - 测试组件缺失时的处理
    - _需求：3.1, 3.2, 3.3, 3.5_

  - [x] 4.4 编写 UI 显示一致性的属性测试
    - **属性 3：UI 显示一致性**
    - **验证：需求 3.1, 3.5**
    - 生成随机饱腹度值
    - 渲染进度条
    - 验证进度条宽度百分比与数据一致
    - 验证数值文本与数据一致

  - [x] 4.5 编写进度条位置顺序性的属性测试
    - **属性 5：进度条位置顺序性**
    - **验证：需求 3.2, 3.3**
    - 渲染完整的角色详情面板
    - 验证饱腹度进度条在 DOM 中的位置
    - 确保在经验值之后、好感度之前

- [x] 5. 检查点 - 确保 UI 层测试通过
  - 运行所有测试确保 UI 显示正确
  - 手动测试 UI 显示效果
  - 如有问题请询问用户

- [x] 6. 实现数据持久化支持
  - [x] 6.1 验证 SaveSystem 对 HungerComponent 的支持
    - 检查 SaveSystem 是否自动序列化所有组件
    - 如需要，添加 HungerComponent 的序列化逻辑
    - 添加旧存档兼容性处理（为没有饱腹度数据的角色初始化默认值）
    - _需求：5.1, 5.2, 5.3, 5.4_

  - [x] 6.2 编写数据持久化的属性测试
    - **属性 4：数据持久化往返一致性**
    - **验证：需求 5.1, 5.2**
    - 生成随机 HungerComponent 数据
    - 序列化后反序列化
    - 验证数据保持不变（往返属性）

  - [x] 6.3 编写旧存档兼容性的单元测试
    - 测试加载包含饱腹度数据的存档
    - 测试加载不包含饱腹度数据的旧存档
    - 验证旧存档加载后角色具有默认饱腹度值
    - _需求：5.4_

- [x] 7. 实现实时数据更新
  - [x] 7.1 确保 CharacterPanel 监听饱腹度变化事件
    - 检查现有的事件监听机制
    - 如需要，添加饱腹度变化事件的监听
    - 确保饱腹度变化时自动更新 UI
    - _需求：6.1, 6.2, 6.3, 6.4_

  - [x] 7.2 编写实时更新的集成测试
    - 测试修改饱腹度值后 UI 自动更新
    - 测试切换选中角色后显示正确的饱腹度
    - 验证进度条动画效果
    - _需求：6.1, 6.4_

- [x] 8. 添加数据验证逻辑
  - [x] 8.1 创建饱腹度值验证函数
    - 实现 validateHunger 函数
    - 确保 current 在 [0, maximum] 范围内
    - 确保 maximum > 0
    - 在设置饱腹度值时调用验证函数
    - _需求：7.1, 7.2, 7.3, 7.4_

  - [x] 8.2 编写数据验证的单元测试
    - 测试边界值：current = 0, current = maximum
    - 测试无效值的限制：current < 0, current > maximum
    - 测试 maximum ≤ 0 的处理
    - _需求：7.1, 7.2, 7.3, 7.4_

- [x] 9. 最终检查点 - 完整功能验证
  - 运行所有单元测试和属性测试
  - 手动测试完整流程：创建角色 → 查看面板 → 保存加载
  - 验证所有需求都已实现
  - 如有问题请询问用户

- [x] 10. 代码审查和文档更新
  - 检查代码风格和注释
  - 确保所有导出的类型都有 JSDoc 注释
  - 更新相关文档（如有需要）

## 注意事项

- 标记为 `*` 的任务是可选的测试任务，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求编号，便于追溯
- 检查点任务确保增量验证，及早发现问题
- 属性测试使用 fast-check 库，每个测试至少运行 100 次迭代
- 单元测试使用 vitest 框架
