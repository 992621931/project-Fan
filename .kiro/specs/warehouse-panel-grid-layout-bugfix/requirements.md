# 需求文档 - 仓库面板网格布局 Bug 修复

## 简介

本文档定义了修复仓库面板物品标签页中网格布局和分页不一致问题的需求。当前实现中，由于 CSS Grid 的 `auto-fill` 和 `minmax()` 特性，每行显示的物品数量会根据容器宽度动态变化，但分页逻辑固定按 12 个物品切片，导致某些页面显示不满 12 个物品，用户需要不必要地翻页。

## 术语表

- **Warehouse_Panel**: 仓库面板，显示玩家拥有的所有物品
- **Item_Grid**: 物品网格，使用 CSS Grid 布局显示物品卡片的容器
- **Items_Per_Page**: 每页物品数量，当前固定为 12
- **Grid_Columns**: 网格列数，由 CSS Grid 的 `auto-fill` 和容器宽度动态计算
- **Grid_Rows**: 网格行数，由物品总数和列数计算得出
- **Visible_Capacity**: 可见容量，当前页面在不滚动的情况下能够显示的物品数量
- **Pagination_Logic**: 分页逻辑，控制每页显示哪些物品的算法

## 需求

### 需求 1: 动态计算每页物品数量

**用户故事:** 作为玩家，我希望每页显示的物品数量能够根据网格布局自动调整，这样我就不需要在页面还有空间时翻页查看剩余物品。

#### 验收标准

1. WHEN Item_Grid 渲染时，THE System SHALL 计算当前网格布局的列数
2. WHEN 网格列数确定后，THE System SHALL 基于列数和目标行数计算每页应显示的物品数量
3. THE System SHALL 使用计算出的每页物品数量进行分页，而不是固定的 12 个
4. WHEN 容器宽度变化导致列数改变时，THE System SHALL 重新计算每页物品数量并更新显示

### 需求 2: 保持网格布局一致性

**用户故事:** 作为玩家，我希望物品网格始终保持整齐的行列布局，这样界面看起来更加美观和专业。

#### 验收标准

1. THE Item_Grid SHALL 使用固定列数的网格布局，而不是 `auto-fill`
2. WHEN 物品数量少于一页容量时，THE System SHALL 显示所有物品而不分页
3. WHEN 物品数量超过一页容量时，THE System SHALL 确保每页（除最后一页外）显示完整的行
4. THE System SHALL 确保最后一页显示剩余的所有物品

### 需求 3: 优化网格列数计算

**用户故事:** 作为玩家，我希望物品网格能够充分利用可用空间，在不同屏幕尺寸下都能显示合适数量的物品。

#### 验收标准

1. THE System SHALL 根据容器宽度和物品卡片最小宽度（120px）计算最优列数
2. THE System SHALL 考虑网格间距（12px gap）在列数计算中
3. WHEN 容器宽度允许时，THE System SHALL 优先显示更多列以最大化空间利用
4. THE System SHALL 确保列数至少为 1，最多为合理的上限（如 8 列）

### 需求 4: 分页控件状态更新

**用户故事:** 作为玩家，我希望分页控件能够准确反映当前的分页状态，这样我就能清楚地知道还有多少页内容。

#### 验收标准

1. WHEN 每页物品数量改变时，THE System SHALL 重新计算总页数
2. WHEN 总页数改变时，THE System SHALL 更新分页控件的显示状态
3. IF 当前页码超出新的总页数，THEN THE System SHALL 自动调整到最后一页
4. THE System SHALL 确保页码指示器显示正确的"当前页/总页数"

### 需求 5: 保持现有筛选功能

**用户故事:** 作为玩家，我希望物品筛选功能在布局修复后仍然正常工作，这样我可以继续按类型查看物品。

#### 验收标准

1. WHEN 用户切换筛选类型时，THE System SHALL 应用筛选并重置到第一页
2. THE System SHALL 基于筛选后的物品数量重新计算分页
3. THE System SHALL 保持筛选标签的视觉状态和交互行为不变
4. WHEN 筛选结果为空时，THE System SHALL 显示空状态提示

### 需求 6: 响应式布局支持

**用户故事:** 作为玩家，我希望在调整浏览器窗口大小时，物品网格能够自动适应新的尺寸，这样我可以在不同的窗口大小下都有良好的体验。

#### 验收标准

1. WHEN 窗口大小改变时，THE System SHALL 检测容器宽度变化
2. IF 容器宽度变化导致列数改变，THEN THE System SHALL 重新计算每页物品数量
3. THE System SHALL 在窗口大小改变后保持当前筛选状态
4. THE System SHALL 在重新计算后调整当前页码以保持用户浏览位置（如果可能）

### 需求 7: 性能优化

**用户故事:** 作为玩家，我希望网格布局的计算和更新不会导致明显的性能问题或界面卡顿。

#### 验收标准

1. THE System SHALL 使用防抖（debounce）技术处理窗口大小改变事件
2. THE System SHALL 缓存列数计算结果，避免重复计算
3. THE System SHALL 仅在列数实际改变时触发重新渲染
4. THE System SHALL 确保网格重新渲染在 100ms 内完成
