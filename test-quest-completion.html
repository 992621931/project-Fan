<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quest Completion Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .quest-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .quest-name {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }
    .quest-progress {
      font-size: 14px;
      color: #667eea;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .quest-rewards {
      font-size: 14px;
      color: #28a745;
      margin-bottom: 12px;
    }
    .button-container {
      display: flex;
      gap: 8px;
    }
    button {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    .complete-btn {
      background: #ffc107;
      color: #333;
    }
    .complete-btn:hover {
      background: #e0a800;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: #28a745;
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      display: none;
    }
  </style>
</head>
<body>
  <h1>ä»»åŠ¡å®Œæˆæµ‹è¯•</h1>
  
  <div id="quest-container"></div>
  <div id="notification" class="notification"></div>

  <script>
    // Test quest data
    const quests = {
      inProgress: [
        {
          id: 'quest_main_1',
          name: 'åˆåˆ°æ‘åº„',
          progress: '1/1',
          rewards: 'ğŸ’° 500é‡‘å¸',
          status: 'inProgress'
        },
        {
          id: 'quest_test_2',
          name: 'æµ‹è¯•ä»»åŠ¡',
          progress: '0/1',
          rewards: 'ğŸ’° 100é‡‘å¸',
          status: 'inProgress'
        }
      ],
      completed: []
    };

    function isQuestObjectiveCompleted(progress) {
      const match = progress.match(/(\d+)\/(\d+)/);
      if (!match) return false;
      
      const current = parseInt(match[1], 10);
      const total = parseInt(match[2], 10);
      
      return current >= total;
    }

    function completeQuest(quest) {
      const questIndex = quests.inProgress.findIndex(q => q.id === quest.id);
      if (questIndex === -1) return;
      
      const completedQuest = quests.inProgress.splice(questIndex, 1)[0];
      completedQuest.status = 'completed';
      quests.completed.push(completedQuest);
      
      const goldMatch = quest.rewards.match(/(\d+)é‡‘å¸/);
      if (goldMatch) {
        const goldAmount = parseInt(goldMatch[1], 10);
        showNotification(`ä»»åŠ¡å®Œæˆï¼è·å¾— ${goldAmount} é‡‘å¸`);
      } else {
        showNotification(`ä»»åŠ¡å®Œæˆï¼`);
      }
      
      renderQuests();
    }

    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    function renderQuests() {
      const container = document.getElementById('quest-container');
      container.innerHTML = '';
      
      quests.inProgress.forEach(quest => {
        const card = document.createElement('div');
        card.className = 'quest-card';
        
        const isCompleted = isQuestObjectiveCompleted(quest.progress);
        
        card.innerHTML = `
          <div class="quest-name">${quest.name}</div>
          <div class="quest-progress">è¿›åº¦: ${quest.progress}</div>
          <div class="quest-rewards">å¥–åŠ±: ${quest.rewards}</div>
          ${isCompleted ? `
            <div class="button-container">
              <button class="complete-btn" onclick="completeQuest(${JSON.stringify(quest).replace(/"/g, '&quot;')})">å®Œæˆ</button>
            </div>
          ` : '<div style="color: #999; font-size: 12px;">ä»»åŠ¡è¿›è¡Œä¸­...</div>'}
        `;
        
        if (isCompleted) {
          const btn = card.querySelector('.complete-btn');
          btn.addEventListener('click', () => completeQuest(quest));
        }
        
        container.appendChild(card);
      });
      
      if (quests.completed.length > 0) {
        const completedSection = document.createElement('div');
        completedSection.innerHTML = '<h2>å·²å®Œæˆä»»åŠ¡</h2>';
        quests.completed.forEach(quest => {
          const card = document.createElement('div');
          card.className = 'quest-card';
          card.style.opacity = '0.7';
          card.innerHTML = `
            <div class="quest-name">âœ“ ${quest.name}</div>
            <div class="quest-progress">è¿›åº¦: ${quest.progress}</div>
            <div class="quest-rewards">å¥–åŠ±: ${quest.rewards}</div>
          `;
          completedSection.appendChild(card);
        });
        container.appendChild(completedSection);
      }
    }

    // Initial render
    renderQuests();
  </script>
</body>
</html>
